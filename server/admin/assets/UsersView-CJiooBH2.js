import{b as A,D as F,_ as P,a as j}from"./Aside.vue_vue_type_script_setup_true_lang-qjtuyiBN.js";import{d as R,m as L,u as T,r as f,c,a as r,w as o,b as t,l as G,j as B,F as M,N as I,e as Q,f as D,g as u,O as H,E as p,P as K,o as i,t as W,I as X,Q as Y,R as Z}from"./index-DwzN7YAn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const h=["admin","editor","user"],ee={class:"dialog-footer"},le=R({__name:"DialogUser",props:{visible:{type:Boolean},visibleModifiers:{}},emits:L(["onSuccess"],["update:visible"]),setup(x,{expose:y,emit:g}){const d=T(x,"visible"),V=g,m=f(!1),b=f(!1),C=()=>({id:"",username:"",password:"",role:""}),l=f(C()),e=f(),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:32,message:"长度在 2 到 32 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:32,message:"密码长度在 6 到 32 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择用户权限",trigger:"change"}]},w=async()=>{e.value&&await e.value.validate((a,s)=>{a&&(!l.value.id||l.value.id===""?k():S())})},k=async()=>{try{m.value=!0,await H(l.value),p.success("保存成功"),V("onSuccess"),_()}catch(a){console.log(a),p.error(a.msg??JSON.stringify(a))}finally{m.value=!1}},S=async()=>{try{m.value=!0,await K(l.value),p.success("保存成功"),V("onSuccess"),_()}catch(a){console.log(a),p.error(a.msg??JSON.stringify(a))}finally{m.value=!1}},N=(a,s=!1)=>{d.value=!0,b.value=s,a&&(l.value={...a})},_=()=>{var a;d.value=!1,(a=e.value)==null||a.resetFields(),l.value=C()};return y({open:N,close:_}),(a,s)=>{const U=r("el-input"),$=r("el-form-item"),E=r("el-radio"),J=r("el-radio-group"),q=r("el-form"),O=r("el-button"),z=r("el-dialog");return i(),c(z,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=n=>d.value=n),title:"用户设置","align-center":"",onClose:_},{footer:o(()=>[D("div",ee,[t(O,{onClick:_,loading:m.value},{default:o(()=>s[4]||(s[4]=[u("取消")])),_:1,__:[4]},8,["loading"]),t(O,{type:"primary",onClick:w,loading:m.value},{default:o(()=>s[5]||(s[5]=[u(" 保存 ")])),_:1,__:[5]},8,["loading"])])]),default:o(()=>[t(q,{model:l.value,rules:v,ref_key:"formRef",ref:e,"label-width":"8rem"},{default:o(()=>[t($,{label:"用户名",prop:"username"},{default:o(()=>[t(U,{modelValue:l.value.username,"onUpdate:modelValue":s[0]||(s[0]=n=>l.value.username=n)},null,8,["modelValue"])]),_:1}),b.value?G("",!0):(i(),c($,{key:0,label:"密码",prop:"password"},{default:o(()=>[t(U,{modelValue:l.value.password,"onUpdate:modelValue":s[1]||(s[1]=n=>l.value.password=n)},null,8,["modelValue"])]),_:1})),t($,{label:"用户权限",prop:"role"},{default:o(()=>[t(J,{modelValue:l.value.role,"onUpdate:modelValue":s[2]||(s[2]=n=>l.value.role=n)},{default:o(()=>[(i(!0),B(M,null,I(Q(h),n=>(i(),c(E,{key:n,value:n},{default:o(()=>[u(W(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),oe={class:"flex justify-between items-center"},ae=R({__name:"UserTable",setup(x){const y=f([]),g=async()=>{try{const l=await Y();y.value=[...l]}catch(l){console.log(l),p.error(l.msg??JSON.stringify(l))}},d=f(),V=()=>{var l;(l=d.value)==null||l.open()},m=l=>{var e;(e=d.value)==null||e.open(l,!0)},b=f(),C=async l=>{try{await Z(l),p.success("删除成功"),g()}catch(e){console.log(e),p.error(e.msg??JSON.stringify(e))}};return X(()=>{g()}),(l,e)=>{const v=r("el-button"),w=r("el-table-column"),k=r("el-tag"),S=r("el-popconfirm"),N=r("el-table"),_=r("el-card");return i(),B(M,null,[t(_,null,{header:o(()=>[D("div",oe,[e[1]||(e[1]=D("div",null,"后台用户管理",-1)),t(v,{type:"primary",onClick:V},{default:o(()=>e[0]||(e[0]=[u("添加用户")])),_:1,__:[0]})])]),default:o(()=>[t(N,{data:y.value},{default:o(()=>[t(w,{label:"用户名",prop:"username"}),t(w,{label:"角色",prop:"role"},{default:o(a=>[a.row.role==="admin"?(i(),c(k,{key:0,type:"success"},{default:o(()=>e[2]||(e[2]=[u("管理员")])),_:1,__:[2]})):a.row.role==="editor"?(i(),c(k,{key:1,type:"primary"},{default:o(()=>e[3]||(e[3]=[u("编辑")])),_:1,__:[3]})):(i(),c(k,{key:2,type:"info"},{default:o(()=>e[4]||(e[4]=[u("用户")])),_:1,__:[4]}))]),_:1}),t(w,{label:"操作",width:"200"},{default:o(a=>[t(v,{type:"primary",size:"small",link:"",onClick:s=>m(a.row)},{default:o(()=>e[5]||(e[5]=[u("编辑")])),_:2,__:[5]},1032,["onClick"]),t(v,{type:"primary",size:"small",link:"",onClick:s=>{var U;return(U=b.value)==null?void 0:U.open(a.row.id)}},{default:o(()=>e[6]||(e[6]=[u(" 修改密码 ")])),_:2,__:[6]},1032,["onClick"]),t(S,{title:"确定要删除吗？",onConfirm:s=>C(a.row.id)},{reference:o(()=>[t(v,{type:"danger",size:"small",link:""},{default:o(()=>e[7]||(e[7]=[u(" 删除 ")])),_:1,__:[7]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),t(A,{ref_key:"dialogPasswordRef",ref:b},null,512),t(le,{ref_key:"dialogUserRef",ref:d,onOnSuccess:g},null,512)],64)}}}),ne=R({__name:"UsersView",setup(x){return(y,g)=>(i(),c(F,null,{header:o(()=>[t(j)]),aside:o(()=>[t(P)]),default:o(()=>[t(ae)]),_:1}))}});export{ne as default};
